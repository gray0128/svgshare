# SVGShare 需求说明书 v2.1

## 1. 项目概述 (Project Overview)

### 背景
现有 SVG 分享方式往往繁琐或依赖大型图床，缺乏针对 SVG 格式优化的查看体验。SVGShare 旨在提供一个极简、快速且美观的 SVG 托管与分享平台。

### 核心价值
- **极简**: 无干扰的用户界面，专注于 SVG 内容本身。
- **快速**: 利用边缘计算实现毫秒级加载。
- **美观**: 极具未来感的设计，提升分享的逼格。

## 2. 用户角色 (User Roles)

### 访客 (Guest)
- 访问分享链接查看 SVG。
- 下载 SVG 文件。
- 使用缩放、平移、重置功能交互式查看。
- 无需登录。

### 注册用户 (User)
- 通过 GitHub 账号登录。
- 上传 SVG 文件。
- 管理已上传的文件（重命名、删除、预览）。
- 生成和管理分享链接（开关控制）。

## 3. 功能需求 (Functional Requirements)

### 3.1 文件上传
- **交互方式**: 支持拖拽文件到上传区域，或点击上传区域选择文件。
- **文件限制**:
    - 格式: 仅支持 `.svg` 扩展名的文件。
    - 大小: 最大 1MB。
- **处理逻辑**:
    - 上传前校验文件格式和大小。
    - 服务端接收并验证。
    - 解析 SVG 元数据（宽、高、ViewBox 等）。
    - 存储文件内容至 R2 对象存储。
    - 存储元数据至 D1 数据库。

### 3.2 文件管理 (Dashboard)
- **展示形式**: 采用 **Bento Grid (便当盒式网格)** 布局，卡片内直接展示 **SVG 缩略图**。
- **操作功能**:
    - **缩略图预览**: 卡片内直接渲染 SVG 缩略图，点击可打开大图预览。
    - **重命名**: 点击编辑图标可修改文件的展示名称。
    - **删除**: 物理删除文件及元数据。
    - **复制链接**: 一键复制分享链接到剪贴板。
    - **分享开关**: 使用 Toggle 开关图标，可视化开启/关闭分享状态。关闭后链接即刻失效。
- **元数据展示**: 默认显示文件名和操作按钮；**悬停时展开**显示：文件大小、尺寸、上传时间。

### 3.3 文件预览与查看
- **渲染**: 基于浏览器原生 SVG 渲染，保证矢量清晰度。
- **交互**:
    - **缩放**: 支持 +/- 按钮缩放，**滚轮缩放灵敏度已优化**（因子 1.03）。
    - **平移**: 支持拖拽平移 (Pan)，适应大尺寸图纸查看。
    - **重置**: 点击重置按钮 (↺) 恢复初始视图。

### 3.4 分享功能
- **唯一链接**: 每个文件生成唯一的分享 ID (UUID)。
- **访客权限**: 拥有"查看"和"下载"权限，**含完整缩放/平移/重置控件**。
- **下载**: 提供源文件下载按钮。

### 3.5 用户管理

将用户账号管理机制从基于机密的白名单，改为使用用户管理功能进行管理维护。

#### 3.5.1 角色与状态定义
- **角色 (Roles)**:
    - **Admin**: 系统管理员。在机密 (Secrets) 中配置，可配置多个。首次登录时直接获得 **Active** 状态，无需审核，且不可被锁定。
    - **User**: 普通用户。通过 GitHub OAuth 注册/登录。
- **状态 (States)**:
    - **Pending (待审核)**: 普通用户首次登录后的默认状态。
    - **Active (正常)**: 审核通过后的状态，具备完整功能权限。
    - **Locked (已锁定)**: 被管理员强制锁定的状态。
- **状态流转**:
    - User 注册 -> Pending
    - Pending -> (Admin 审核) -> Active
    - Active -> (Admin 锁定) -> Locked
    - Locked -> (Admin 解锁) -> Active
- **受限状态 UI**:
    - **Pending**: 登录后全屏显示 "等待管理员审核中"，仅保留 **退出登录** 功能，禁用上传和其他操作。
    - **Locked**: 登录后（或被锁定时）全屏显示 "账号已被锁定"，仅保留 **退出登录** 功能。

#### 3.5.2 用户管理列表 (Admin Dashboard)
为管理员提供专属的用户管理页面。
- **列表展示**:
    - **用户账号**: GitHub 用户名/头像。
    - **角色**: Admin / User。
    - **注册时间**: 首次登录时间。
    - **状态**: Pending / Active / Locked。
    - **操作**: 审核、锁定/解锁。
- **筛选与搜索**:
    - 支持按 **角色** (Admin/User) 筛选。
    - 支持按 **状态** (Pending/Active/Locked) 筛选。
    - 支持搜索用户账号。
- **分页**: 支持大量数据的分页展示。

#### 3.5.3 管理操作
- **审核 (Approve)**: 将用户状态从 Pending 变更为 Active。
- **锁定 (Lock)**: 将用户状态从 Active 变更为 Locked (仅针对 User 角色)。
- **解锁 (Unlock)**: 将用户状态从 Locked 变更为 Active。

#### 3.5.4 退出登录 (Logout)
- 所有用户（包括处于 Pending 和 Locked 状态的用户）均可在界面可见 **退出登录** 按钮。
- 点击后清除本地会话，重定向至首页。


## 4. 非功能需求 (Non-Functional Requirements)

### 4.1 架构与工程质量
- **清晰架构**: 遵循关注点分离原则 (SoC)，代码结构清晰。
- **模块化**: 核心功能（存储适配器、鉴权模块、渲染组件）解耦。
- **无构建**: 保持代码简单，无需 Webpack/Vite，直接运行于 Worker 环境。

### 4.2 性能
- **边缘加速**: 利用 Cloudflare Workers 边缘节点分发。
- **CDN 缓存**: 合理配置 Cache-Control。

### 4.3 安全性
- **身份认证**: 仅使用 GitHub OAuth，不自行维护密码。
- **资源隔离**: R2 存储桶设置为私有，必须通过 Worker 鉴权后代理访问。
- **XSS 防护**: SVG 预览时自动移除 `<script>` 标签和 `on*` 事件属性。

### 4.4 兼容性
- 兼容主流现代浏览器 (Chrome, Edge, Firefox, Safari)。
- 响应式设计，适配桌面端和移动端查看。

## 5. UI/UX 设计规范 (Design Specifications)

### 风格定义
**Keyword**: Future Tech, Swiss Design, Precision, Minimalist.
设计融合"未来科技"与"瑞士平面设计"风格。

### 视觉元素
- **布局**: Bento Grid，高度结构化，网格分明，卡片高度 280px。
- **色彩**:
    - **背景**: 极暗深灰 (`#0a0a0a`)。
    - **主色**: 电光橙 (`#FF3300`)，用于主按钮、高亮、悬停边框。
    - **卡片**: 实心深灰 (`#111111`)，无磨砂效果。
- **质感**:
    - **噪点 (Noise)**: 全局叠加细微噪点纹理。
    - **扫描线 (Scanline)**: CRT 屏幕效果的水平扫描线。
    - **光晕 (Glow)**: 悬停时边缘散发微弱橙色辉光。
- **字体**:
    - 标题/正文: `Inter` (Bold 800)。
    - 数据/代码: `JetBrains Mono`。
- **图标**: Google Material Symbols (Outlined)。

## 6. 技术架构 (Technical Architecture)

- **Frontend**: 原生 HTML5, CSS3 (CSS Variables), ES6+ JavaScript, Web Components。
- **Backend Runtime**: Cloudflare Workers (ES Modules)。
- **Database**: Cloudflare D1 (SQLite) - 存储 User, File Metadata。
- **Storage**: Cloudflare R2 - 存储 SVG Blob。
- **Auth**: GitHub OAuth 2.0 Flow。
